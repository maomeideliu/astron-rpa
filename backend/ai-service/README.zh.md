# AI Service - æ™ºèƒ½æœåŠ¡å¹³å°

## ğŸ“– é¡¹ç›®ä»‹ç»

AI Service æ˜¯ä¸€ä¸ªåŸºäº FastAPI æ„å»ºçš„ç»¼åˆæ€§æ™ºèƒ½æœåŠ¡å¹³å°ï¼Œé›†æˆäº†å¤šç§ AI èƒ½åŠ›å’Œå®Œæ•´çš„ç§¯åˆ†ç®¡ç†ç³»ç»Ÿã€‚å¹³å°æä¾›äº†èŠå¤©å¯¹è¯ã€OCR æ–‡å­—è¯†åˆ«ã€éªŒè¯ç è¯†åˆ«ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶é€šè¿‡ç§¯åˆ†æœºåˆ¶å®ç°æœåŠ¡ä½¿ç”¨çš„ç²¾ç»†åŒ–ç®¡ç†ã€‚

### âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ¤– **AI èŠå¤©æœåŠ¡** - å¯¹æ¥ DeepSeek ç­‰å¤§è¯­è¨€æ¨¡å‹ï¼Œæ”¯æŒæµå¼å’Œéæµå¼å¯¹è¯
- ğŸ“ **OCR æ–‡å­—è¯†åˆ«** - é›†æˆè®¯é£é€šç”¨æ–‡å­—è¯†åˆ« APIï¼Œæ”¯æŒä¸­è‹±æ–‡æ··åˆè¯†åˆ«
- ğŸ” **éªŒè¯ç è¯†åˆ«** - é›†æˆäº‘ç éªŒè¯ç è¯†åˆ«æœåŠ¡ï¼Œæ”¯æŒå¤šç§éªŒè¯ç ç±»å‹
- ğŸ’° **ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ** - å®Œæ•´çš„ç”¨æˆ·ç§¯åˆ†åˆ†é…ã€æ¶ˆè´¹ã€è¿‡æœŸå’Œä¼˜å…ˆçº§ç®¡ç†
- ğŸ“Š **è¯·æ±‚é“¾è·¯è¿½è¸ª** - å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œè¯·æ±‚ ID è¿½è¸ªæœºåˆ¶
- ğŸ”§ **å¼‚æ­¥é«˜æ€§èƒ½** - åŸºäº FastAPI å¼‚æ­¥æ¡†æ¶ï¼Œæ”¯æŒé«˜å¹¶å‘è¯·æ±‚
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²** - æä¾›å®Œæ•´çš„ Docker å’Œ Docker Compose éƒ¨ç½²æ–¹æ¡ˆ

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. AI èŠå¤©æœåŠ¡ (`/v1/chat/completions`)
- æ”¯æŒæµå¼å’Œéæµå¼å¯¹è¯æ¨¡å¼
- å…¼å®¹ OpenAI ChatGPT API æ ¼å¼
- è‡ªåŠ¨ç§¯åˆ†æ‰£é™¤å’Œä½™é¢æ£€æŸ¥
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### 2. AI æ¨¡å‹ç®¡ç† (`/v1/models`)
- åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„ AI æ¨¡å‹
- è¿”å›æ¨¡å‹åç§°ã€ID å’Œå…¶ä»–å…ƒæ•°æ®
- ç”¨äºåŠ¨æ€å‘ç°å’Œé€‰æ‹©æ¨¡å‹ 

### 3. OCR æ–‡å­—è¯†åˆ« (`/ocr/general`)
- åŸºäºè®¯é£é€šç”¨æ–‡å­—è¯†åˆ« API
- æ”¯æŒä¸­è‹±æ–‡æ··åˆæ–‡æœ¬è¯†åˆ«
- æ”¯æŒæ‰‹å†™å’Œå°åˆ·ä½“æ–‡å­—
- æ”¯æŒå€¾æ–œæ–‡æœ¬å’Œç”Ÿåƒ»å­—ä¼˜åŒ–
- è‡ªåŠ¨ç§¯åˆ†æ‰£é™¤æœºåˆ¶

### 4. éªŒè¯ç è¯†åˆ« (`/jfbym/customApi`)
- é›†æˆäº‘ç éªŒè¯ç è¯†åˆ«æœåŠ¡
- æ”¯æŒå¤šç§éªŒè¯ç ç±»å‹
- é«˜å‡†ç¡®ç‡è¯†åˆ«
- æŒ‰æˆåŠŸæ‰£è´¹æœºåˆ¶ï¼ˆä»…æˆåŠŸæ—¶æ‰£é™¤ç§¯åˆ†ï¼‰
- ä¸­æ–‡é”™è¯¯ä¿¡æ¯è¿”å›

### 5. ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ
- **åˆ†é…ç­–ç•¥**ï¼šæœˆåº¦è‡ªåŠ¨å‘æ”¾ã€æ‰‹åŠ¨æ·»åŠ ã€ä¼˜å…ˆçº§ç®¡ç†
- **æ¶ˆè´¹ç­–ç•¥**ï¼šæŒ‰ä¼˜å…ˆçº§å’Œè¿‡æœŸæ—¶é—´æ¶ˆè´¹
- **è¿‡æœŸç®¡ç†**ï¼šæ”¯æŒå¤šç§è¿‡æœŸç­–ç•¥ï¼ˆ30å¤©ã€æœˆæœ«ã€æ°¸ä¸è¿‡æœŸç­‰ï¼‰
- **ç¼“å­˜ä¼˜åŒ–**ï¼šRedis ç¼“å­˜ç”¨æˆ·ç§¯åˆ†ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½

### 6. ç®¡ç†å‘˜æ¥å£ (`/admin`)
- ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢å’Œç®¡ç†
- æ‰‹åŠ¨æ·»åŠ /æ‰£é™¤ç§¯åˆ†
- ç§¯åˆ†ä½¿ç”¨ç»Ÿè®¡å’Œç›‘æ§

## ğŸ›  æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬è¦æ±‚ |
|------|----------|----------|
| **åç«¯æ¡†æ¶** | FastAPI | >=0.115.12 |
| **Python** | Python | >=3.13 |
| **æ•°æ®åº“** | MySQL + SQLAlchemy | >=2.0.41 |
| **ç¼“å­˜** | Redis | >=6.1.0 |
| **å¼‚æ­¥æ”¯æŒ** | asyncio + aiomysql | >=0.2.0 |
| **é…ç½®ç®¡ç†** | Pydantic Settings | >=2.9.1 |
| **å®¹å™¨åŒ–** | Docker + Docker Compose | - |
| **æµ‹è¯•æ¡†æ¶** | pytest + pytest-asyncio | >=8.3.5 |
| **ä»£ç è´¨é‡** | Ruff | >=0.11.11 |
| **åŠ å¯†æ”¯æŒ** | bcrypt + cryptography | >=4.3.0 |

## ğŸ“ é¡¹ç›®ç»“æ„

```
ai-service/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ main.py                   # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py               # æ•°æ®åº“è¿æ¥å’Œä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ redis_op.py               # Redis è¿æ¥æ± ç®¡ç†
â”‚   â”œâ”€â”€ logger.py                 # æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ dependencies/             # ä¾èµ–æ³¨å…¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py          # é€šç”¨ä¾èµ–
â”‚   â”‚   â””â”€â”€ points.py            # ç§¯åˆ†ç›¸å…³ä¾èµ–
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ point.py             # ç§¯åˆ†ç›¸å…³æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/                  # Pydantic æ•°æ®æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ chat.py              # èŠå¤©æ¥å£æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ ocr.py               # OCR æ¥å£æ¨¡å¼
â”‚   â”‚   â””â”€â”€ jfbym.py             # éªŒè¯ç æ¥å£æ¨¡å¼
â”‚   â”œâ”€â”€ routers/                  # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ocr.py               # OCR è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ jfbym.py             # éªŒè¯ç è·¯ç”±
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ chat.py          # èŠå¤©è·¯ç”±
â”‚   â”‚       â””â”€â”€ models.py        # æ¨¡å‹ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â””â”€â”€ point.py             # ç§¯åˆ†ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ ocr.py               # OCR å·¥å…·
â”‚   â”‚   â””â”€â”€ jfbym.py             # éªŒè¯ç å·¥å…·
â”‚   â”œâ”€â”€ middlewares/              # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ tracing.py           # è¯·æ±‚è¿½è¸ªä¸­é—´ä»¶
â”‚   â””â”€â”€ internal/                 # å†…éƒ¨ç®¡ç†æ¥å£
â”‚       â””â”€â”€ admin.py             # ç®¡ç†å‘˜æ¥å£
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ conftest.py              # æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ test_main.py             # ä¸»åº”ç”¨æµ‹è¯•
â”‚   â””â”€â”€ routers/                 # è·¯ç”±æµ‹è¯•
â”œâ”€â”€ logs/                         # æ—¥å¿—ç›®å½•ï¼ˆå¦‚ app.logï¼‰
â”œâ”€â”€ docker-compose.yml            # ç”Ÿäº§ç¯å¢ƒ Docker Compose
â”œâ”€â”€ docker-compose.test.yaml      # æµ‹è¯•ç¯å¢ƒ Docker Compose
â”œâ”€â”€ Dockerfile                    # Docker é•œåƒæ„å»º
â”œâ”€â”€ pyproject.toml                # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ uv.lock                       # uv ä¾èµ–é”å®šæ–‡ä»¶
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.13+
- MySQL 8.0+
- Redis 7.0+
- Docker & Docker Compose (å¯é€‰)

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd ai-service
```

### 2. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ pip å®‰è£…
pip install -e .

# æˆ–ä½¿ç”¨ uv (æ¨è)
uv sync
```

> æ¨èä½¿ç”¨ [uv](https://github.com/astral-sh/uv) è¿›è¡Œä¾èµ–ç®¡ç†ï¼Œ`uv.lock` æ–‡ä»¶å·²é”å®šä¾èµ–ç‰ˆæœ¬ï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§ã€‚

### 3. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=mysql+aiomysql://username:password@localhost:3306/ai_service
DATABASE_USERNAME=your_db_username
DATABASE_PASSWORD=your_db_password

# Redis é…ç½®
REDIS_URL=redis://localhost:6379/0

# AI èŠå¤©æœåŠ¡é…ç½®
AICHAT_BASE_URL=https://api.deepseek.com/v1/
AICHAT_API_KEY=your_deepseek_api_key

# è®¯é£ OCR é…ç½®
XFYUN_APP_ID=your_xfyun_app_id
XFYUN_API_SECRET=your_xfyun_api_secret
XFYUN_API_KEY=your_xfyun_api_key

# äº‘ç éªŒè¯ç é…ç½®
JFBYM_API_TOKEN=your_jfbym_token

# ç§¯åˆ†ç­–ç•¥é…ç½®ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œä½¿ç”¨é»˜è®¤çš„ .env.default
MONTHLY_GRANT_AMOUNT=100000
AICHAT_POINTS_COST=100
OCR_GENERAL_POINTS_COST=50
JFBYM_POINTS_COST=10
```

### 4. å¯åŠ¨æœåŠ¡

```bash
uv run fastapi dev
```

### 5. éªŒè¯æœåŠ¡

è®¿é—® [http://localhost:8010/docs](http://localhost:8010/docs) æŸ¥çœ‹ API æ–‡æ¡£ã€‚

## ğŸ³ Docker éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **é…ç½®ç¯å¢ƒå˜é‡**

   åˆ›å»º `.env` æ–‡ä»¶å¹¶é…ç½®ç›¸å…³ç¯å¢ƒå˜é‡ã€‚

2. **å¯åŠ¨æœåŠ¡**

   ```bash
   docker-compose up -d
   ```

3. **æŸ¥çœ‹æœåŠ¡çŠ¶æ€**

   ```bash
   docker-compose ps
   docker-compose logs -f app
   ```

### å•å…ƒæµ‹è¯•ç¯å¢ƒéƒ¨ç½²

1. **å¯åŠ¨æµ‹è¯•ä¾èµ–æœåŠ¡**

   ```bash
   docker-compose -f docker-compose.test.yaml up -d
   ```

2. **è¿è¡Œæµ‹è¯•**

   ```bash
   pytest
   ```

## ğŸ“š API æ–‡æ¡£

### è®¤è¯è¯´æ˜

æ‰€æœ‰ API è¯·æ±‚éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«ç”¨æˆ· IDï¼š

```bash
X-User-Id: 123
# æˆ–
user_id: 123
```

### æ ¸å¿ƒæ¥å£

#### 1. AI èŠå¤©æ¥å£

**POST** `/v1/chat/completions`

```json
{
  "model": "deepseek-chat",
  "messages": [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "Hello!"}
  ],
  "stream": false,
  "temperature": 0.7,
  "max_tokens": 4096
}
```

#### 2. OCR æ–‡å­—è¯†åˆ«

**POST** `/ocr/general`

```json
{
  "image": "base64_encoded_image_string",
  "encoding": "jpg",
  "status": 3
}
```

#### 3. éªŒè¯ç è¯†åˆ«

**POST** `/jfbym/customApi`

```json
{
  "type": "éªŒè¯ç ç±»å‹",
  "image": "base64_encoded_image_string"
}
```

**å“åº”æ ¼å¼ï¼š**
```json
{
  "code": 10000,
  "message": "success",
  "data": {
    "code": 0,
    "data": "è¯†åˆ«ç»“æœ"
  }
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
  "code": 400,
  "message": "äº‘ç éªŒè¯ç å¤„ç†å¤±è´¥: å…·ä½“é”™è¯¯ä¿¡æ¯",
  "data": null
}
```

#### 4. ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢

**GET** `/admin/user/points?user_id=123`

#### 5. æ‰‹åŠ¨æ·»åŠ ç§¯åˆ†

**POST** `/admin/user/points?user_id=123&amount=1000`

## âš™ï¸ é…ç½®è¯´æ˜

### ç§¯åˆ†ç­–ç•¥é…ç½®

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `MONTHLY_GRANT_AMOUNT` | 100000 | æœˆåº¦è‡ªåŠ¨å‘æ”¾ç§¯åˆ†æ•°é‡ |
| `AICHAT_POINTS_COST` | 100 | AI èŠå¤©æ¯æ¬¡è¯·æ±‚æ¶ˆè€—ç§¯åˆ† |
| `OCR_GENERAL_POINTS_COST` | 50 | OCR è¯†åˆ«æ¯æ¬¡æ¶ˆè€—ç§¯åˆ† |
| `JFBYM_POINTS_COST` | 10 | éªŒè¯ç è¯†åˆ«æ¯æ¬¡æ¶ˆè€—ç§¯åˆ† |

### ç§¯åˆ†è¿‡æœŸç­–ç•¥

- **æœˆåº¦å‘æ”¾ç§¯åˆ†**ï¼šå½“æœˆæœˆæœ«è¿‡æœŸ
- **æ‰‹åŠ¨æ·»åŠ ç§¯åˆ†**ï¼šæ°¸ä¸è¿‡æœŸ
- **å…¶ä»–ç±»å‹ç§¯åˆ†**ï¼š30 å¤©åè¿‡æœŸ

### æ—¥å¿—é…ç½®

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `LOG_LEVEL` | INFO | æ—¥å¿—çº§åˆ«ï¼ˆDEBUG, INFO, WARNING, ERRORï¼‰ |
| `LOG_DIR` | /var/log/ai_service | æ—¥å¿—æ–‡ä»¶å­˜å‚¨ç›®å½• |

## ğŸ§ª å¼€å‘æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# å¯åŠ¨æµ‹è¯•æ•°æ®åº“
docker-compose -f docker-compose.test.yaml up -d

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/routers/test_chat.py

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¦†ç›–ç‡
pytest --cov=app
```

### ä»£ç è´¨é‡æ£€æŸ¥

```bash
# æ ¼å¼åŒ–ä»£ç 
ruff format

# æ£€æŸ¥ä»£ç è´¨é‡
ruff check

# ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜
ruff check --fix
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log
```

### æ–°å¢æœåŠ¡æ¨¡å—

1. åœ¨ `app/routers/` ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶
2. åœ¨ `app/schemas/` ä¸‹å®šä¹‰æ•°æ®æ¨¡å¼
3. åœ¨ `app/utils/` ä¸‹å®ç°å…·ä½“é€»è¾‘
4. åœ¨ `app/main.py` ä¸­æ³¨å†Œè·¯ç”±
5. ç¼–å†™å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹

### æ·»åŠ æ–°çš„ç§¯åˆ†æ¶ˆè´¹ç±»å‹

1. åœ¨ `app/models/point.py` ä¸­çš„ `PointTransactionType` æšä¸¾æ·»åŠ æ–°ç±»å‹
2. åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ç§¯åˆ†æ¶ˆè´¹é…ç½®
3. ä½¿ç”¨ `PointChecker` ä¾èµ–æ³¨å…¥è¿›è¡Œç§¯åˆ†æ£€æŸ¥å’Œæ‰£é™¤

> æ³¨æ„ï¼šæ·»åŠ æ–°çš„ç§¯åˆ†ç±»å‹åï¼Œéœ€è¦æ‰‹åŠ¨å‡çº§æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®è¿™ä¹ˆåšã€‚

## ğŸ“ æ—¥å¿—è¯´æ˜

### æ—¥å¿—é…ç½®

- **æ—¥å¿—çº§åˆ«**ï¼šé€šè¿‡ `LOG_LEVEL` ç¯å¢ƒå˜é‡é…ç½®ï¼ˆé»˜è®¤ï¼šINFOï¼‰
- **æ—¥å¿—ç›®å½•**ï¼šé€šè¿‡ `LOG_DIR` ç¯å¢ƒå˜é‡é…ç½®ï¼ˆé»˜è®¤ï¼š/var/log/ai_serviceï¼‰
- **æ—¥å¿—æ ¼å¼**ï¼šåŒ…å«æ—¶é—´æˆ³ã€æ¨¡å—åã€è¯·æ±‚ IDã€æ—¥å¿—çº§åˆ«å’Œæ¶ˆæ¯å†…å®¹
- **æ—¥å¿—è½®è½¬**ï¼šå•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 10MBï¼Œä¿ç•™ 10 ä¸ªå†å²æ–‡ä»¶

### è¯·æ±‚è¿½è¸ª

æ¯ä¸ªè¯·æ±‚éƒ½ä¼šåˆ†é…å”¯ä¸€çš„ Request IDï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ï¼š

```
2025-06-03 10:30:15 - app.main - [abc-123-def] - INFO - Root endpoint accessed!
```

### æ—¥å¿—è¾“å‡º

- **æ§åˆ¶å°è¾“å‡º**ï¼šåŒ…å«è¯·æ±‚ ID çš„æ ¼å¼åŒ–æ—¥å¿—
- **æ–‡ä»¶è¾“å‡º**ï¼šåŒ…å«è¯·æ±‚ ID çš„æ ¼å¼åŒ–æ—¥å¿—ï¼Œæ”¯æŒæ—¥å¿—è½®è½¬
- **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰å¼‚å¸¸éƒ½ä¼šè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é‡ç½®ç”¨æˆ·ç§¯åˆ†ï¼Ÿ

A: å¯ä»¥é€šè¿‡ç®¡ç†å‘˜æ¥å£æ‰‹åŠ¨æ‰£é™¤ç”¨æˆ·å½“å‰æ‰€æœ‰ç§¯åˆ†ï¼Œç„¶åé‡æ–°æ·»åŠ ï¼š

```bash
# 1. æŸ¥è¯¢ç”¨æˆ·å½“å‰ç§¯åˆ†
curl -X GET "http://localhost:8010/admin/user/points?user_id=123"

# 2. æ‰£é™¤æ‰€æœ‰ç§¯åˆ†
curl -X POST "http://localhost:8010/admin/user/points/deduct?user_id=123&amount=å½“å‰ç§¯åˆ†æ•°"

# 3. æ·»åŠ æ–°çš„ç§¯åˆ†
curl -X POST "http://localhost:8010/admin/user/points?user_id=123&amount=æ–°ç§¯åˆ†æ•°"
```

### Q: ç§¯åˆ†ä¸è¶³æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ

A: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥ç”¨æˆ·ç§¯åˆ†ï¼Œå¦‚æœä¸è¶³ä¼šè¿”å› 403 çŠ¶æ€ç ã€‚ç”¨æˆ·éœ€è¦è”ç³»ç®¡ç†å‘˜æ·»åŠ ç§¯åˆ†æˆ–ç­‰å¾…æœˆåº¦è‡ªåŠ¨å‘æ”¾ã€‚

### Q: å¦‚ä½•ç›‘æ§æœåŠ¡å¥åº·çŠ¶å†µï¼Ÿ

A: å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç›‘æ§ï¼š

1. è®¿é—®æ ¹è·¯å¾„ `/` æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸å“åº”
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†è¿è¡Œæƒ…å†µ
3. ç›‘æ§ Redis å’Œ MySQL è¿æ¥çŠ¶æ€
4. æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼ˆå¦‚æœä½¿ç”¨ Dockerï¼‰

### Q: å¦‚ä½•å¤‡ä»½å’Œæ¢å¤æ•°æ®ï¼Ÿ

A: 

**å¤‡ä»½ï¼š**
```bash
# å¤‡ä»½ MySQL æ•°æ®
docker exec mysql_container mysqldump -u root -p ai_service > backup.sql

# å¤‡ä»½ Redis æ•°æ®
docker exec redis_container redis-cli BGSAVE
```

**æ¢å¤ï¼š**
```bash
# æ¢å¤ MySQL æ•°æ®
docker exec -i mysql_container mysql -u root -p ai_service < backup.sql
```

### Q: éªŒè¯ç è¯†åˆ«å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: éªŒè¯ç è¯†åˆ«å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

- **ä¸šåŠ¡é€»è¾‘é”™è¯¯**ï¼šè¿”å› 400 çŠ¶æ€ç å’Œå…·ä½“é”™è¯¯ä¿¡æ¯
- **ç½‘ç»œé”™è¯¯**ï¼šè¿”å› 503 çŠ¶æ€ç ï¼Œæç¤ºæœåŠ¡æš‚æ—¶ä¸å¯ç”¨
- **æœªçŸ¥é”™è¯¯**ï¼šè¿”å› 500 çŠ¶æ€ç ï¼Œæç¤ºå‘ç”ŸæœªçŸ¥é”™è¯¯

æ‰€æœ‰é”™è¯¯ä¿¡æ¯éƒ½æ˜¯ä¸­æ–‡ï¼Œä¾¿äºç”¨æˆ·ç†è§£ã€‚

### Q: æ—¥å¿—ä¸­çœ‹ä¸åˆ° request_id æ€ä¹ˆåŠï¼Ÿ

A: ç¡®ä¿ï¼š

1. åº”ç”¨æ­£ç¡®é…ç½®äº† `RequestTracingMiddleware` ä¸­é—´ä»¶
2. æ—¥å¿—é…ç½®ä¸­åŒ…å«äº† `RequestIdFilter`
3. æ£€æŸ¥æ—¥å¿—æ ¼å¼æ˜¯å¦åŒ…å« `%(request_id)s`

å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯ä»¥æ£€æŸ¥æ—¥å¿—é…ç½®å’Œä¸­é—´ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚
